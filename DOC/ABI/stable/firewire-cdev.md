**What**: /dev/fw[0-9]+

**Date**: 五月 2007

**KernelVersion**: 2.6.22

**Contact**: linux1394-devel@lists.sourceforge.net

**Description**:

    字符设备文件 /dev/fw* 是 firewire-core 与在用户空间实现的 IEEE 1394 设备驱动程序之间的接口。在 <linux/firewire-cdev.h> 中定义和记录了基于 ioctl(2) 和 read(2) 的 ABI。

    此 ABI 提供了 firewire-core 也向内核空间 IEEE 1394 驱动程序公开的大部分功能。

    每个 /dev/fw* 都与一个 IEEE 1394 节点相关联，该节点可以是远程或本地节点。对 /dev/fw* 文件的操作具有不同的范围：

      - 与文件关联的 1394 节点：

          - 异步请求传输

          - 获取配置 ROM

          - 查询节点 ID

          - 查询此节点与本地节点之间路径的最大速度

      - 节点连接到的 1394 总线（即“卡”）：

          - 等时流传输和接收

          - 异步流传输和接收

          - 异步广播请求传输

          - PHY 数据包传输和接收

          - 在总线的 IRM 上分配、重新分配、释放等时资源（通道、带宽）

          - 查询本地节点、根节点、IRM、总线管理器的节点 ID

          - 查询周期时间

          - 启动总线重置，接收总线重置事件

      - 所有 1394 总线：

          - 在本地链路层上分配 IEEE 1212 地址范围，接收对此类地址范围的入站请求，对入站请求进行异步响应传输

          - 向本地节点的配置 ROM 添加描述符或目录

    由于操作的范围不同，并且为了让用户空间实现不同的访问权限模型，一些操作仅限于与本地节点关联的 /dev/fw* 文件：

          - 向本地节点的配置 ROM 添加描述符或目录

          - PHY 数据包传输和接收

    在其整个生命周期中，一个 /dev/fw* 文件始终与一个特定节点相关联。firewire-core 会跟踪总线拓扑变化，因此节点 ID 变化。ABI 用户不需要了解拓扑。

    支持以下文件操作：

    open(2)

    当前唯一有用的标志是 O_RDWR。

    ioctl(2)

    启动各种操作。 有些立即生效，其他操作在 ioctl 返回时或之后异步执行。有关所有 ioctl 的描述，请参阅 <linux/firewire-cdev.h> 中的内联文档。

    poll(2)、select(2)、epoll_wait(2) 等。

    监视事件是否可供读取。

    read(2)

    接收各种事件。 有请求事件，如出站异步事务完成或等时缓冲区完成，以及未经请求的事件，如总线重置、请求接收或 PHY 数据包接收。 始终使用足够大的读取缓冲区来接收可能到达的最大事件。有关所有事件类型以及哪些 ioctl 影响事件接收的描述，请参阅 <linux/firewire-cdev.h>。

    mmap(2)

    为等时接收或传输分配 DMA 缓冲区，并将其映射到进程地址空间。参数应如下使用：addr = NULL，length = 所需的缓冲区大小，即数据包数量乘以最大数据包的大小，prot = 对于接收至少 PROT_READ，对于传输至少 PROT_WRITE，flags = MAP_SHARED，fd = /dev/fw* 的句柄，offset = 0。

    等时接收以每缓冲区一个数据包的方式工作，除了多通道接收以缓冲区填充模式工作。

    munmap(2)

    从进程地址空间取消映射等时 I/O 缓冲区。

    close(2)

    除了停止和释放与文件描述符关联的 I/O 上下文之外，回滚对本地节点的配置 ROM 的任何更改。在 IRM 上释放标记为内核辅助重新分配和释放的等时通道和带宽。

**Users**: libraw1394

    libdc1394

    诸如 jujuutils、fwhack 等工具