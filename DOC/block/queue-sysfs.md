# 队列系统文件

=================

此文本文件将详细介绍位于每个块设备的 sysfs 树中的队列文件。请注意，堆叠设备通常不导出任何设置，因为它们的队列功能仅仅是重映射目标。这些文件位于 /sys/block/xxx/queue/ 目录中。带有 RO 后缀的文件是只读的，带有 RW 后缀的文件表示可读可写。

add_random (RW)

----------------

此文件允许关闭磁盘熵贡献。此文件的默认值为 '1'（开启）。

discard_granularity (RO)

-----------------------

如果设备报告，此文件将显示设备内部分配的大小（以字节为单位）。值为 '0' 表示设备不支持丢弃功能。

discard_max_bytes (RO)

----------------------

支持丢弃功能的设备可能对单个操作中可以修剪或取消映射的字节数有内部限制。discard_max_bytes 参数由设备驱动程序设置为单个操作中可以丢弃的最大字节数。发送到设备的丢弃请求不得超过此限制。discard_max_bytes 值为 0 表示设备不支持丢弃功能。

discard_zeroes_data (RO)

------------------------

读取此文件时，将显示设备是否将丢弃的块清零。如果其值为 '1'，则块被清零，否则未清零。

hw_sector_size (RO)

-------------------

这是设备的硬件扇区大小（以字节为单位）。

iostats (RW)

-------------

此文件用于控制（开启/关闭）磁盘的 I/O 统计信息。

logical_block_size (RO)

-----------------------

这是设备的逻辑块大小（以字节为单位）。

max_hw_sectors_kb (RO)

----------------------

这是单个数据传输中支持的最大千字节数。

max_integrity_segments (RO)

---------------------------

读取此文件时，将显示块层设置的硬件控制器可以处理的完整性段的最大限制。

max_sectors_kb (RW)

-------------------

这是块层将允许文件系统请求的最大千字节数。必须小于或等于硬件允许的最大大小。

max_segments (RO)

-----------------

设备的最大段数。

max_segment_size (RO)

---------------------

设备的最大段大小。

minimum_io_size (RO)

--------------------

这是设备报告的最小首选 IO 大小。

nomerges (RW)

-------------

此选项允许用户在块层中禁用与 IO 合并请求相关的查找逻辑。默认值（0）为启用所有合并。设置为 1 时，仅尝试简单的单次命中合并。设置为 2 时，将不尝试任何合并算法（包括单次命中或更复杂的树/哈希查找）。

nr_requests (RW)

----------------

此控制在块层中可以为读取或写入请求分配的请求数量。请注意，分配的总数可能是此数量的两倍，因为它仅适用于读取或写入（不是累积总和）。

为避免通过请求饥饿导致优先级反转，当启用 CONFIG_BLK_CGROUP 时，请求队列为每个 cgroup 维护一个单独的请求池，并且此参数适用于每个这样的每个块 cgroup 请求池。也就是说，如果有 N 个块 cgroup，每个请求队列最多可以有 N 个请求池，每个请求池由 nr_requests 独立调节。

optimal_io_size (RO)

--------------------

这是设备报告的最佳 IO 大小。

physical_block_size (RO)

------------------------

这是设备的物理块大小（以字节为单位）。

read_ahead_kb (RW)

------------------

此块设备上文件系统的预读最大千字节数。

rotational (RW)

---------------

此文件用于声明设备是旋转类型还是非旋转类型。

rq_affinity (RW)

----------------

如果此选项为 '1'，块层将把请求完成迁移到最初提交请求的 CPU“组”。对于某些工作负载，由于缓存效应，这可显著减少 CPU 周期。

对于需要最大程度分布完成处理的存储配置，将此选项设置为 '2' 可强制完成在请求 CPU 上运行（绕过“组”聚合逻辑）。

scheduler (RW)

--------------

读取此文件时，将显示此块设备的当前和可用的 I/O 调度程序。当前活动的 I/O 调度程序将用 [] 括起来。将一个 I/O 调度程序名称写入此文件将把此块设备的控制切换到该新的 I/O 调度程序。请注意，将一个 I/O 调度程序名称写入此文件将尝试加载该 I/O 调度程序模块，如果它尚未在系统中存在。

Jens Axboe <jens.axboe@oracle.com>，2009 年 2 月