# ACPI 表

-----------

以下列表中讨论了各个 ACPI 表的预期用途。

如果使用了章节编号，它指的是 ACPI 规范中定义该对象的章节编号。如果使用“签名保留”，则表签名（表的前四个字节）是规范唯一识别的表的部分，实际的表是在 UEFI 论坛之外定义的（见规范的第 5.2.6 节）。

对于 arm64 上的 ACPI，表还分为以下类别：

       -- 必需：DSDT、FADT、GTDT、MADT、MCFG、RSDP、SPCR、XSDT

       -- 推荐：BERT、EINJ、ERST、HEST、SSDT

       -- 可选：BGRT、CPEP、CSRT、DRTM、ECDT、FACS、FPDT、MCHI、MPST、

          MSCT、RASF、SBST、SLIT、SPMI、SRAT、TCPA、TPM2、UEFI

       -- 不支持：BOOT、DBG2、DBGP、DMAR、ETDT、HPET、IBFT、IVRS、

          LPIT、MSDM、RSDT、SLIC、WAET、WDAT、WDRT、WPBT

# ARMv8 Linux 的表用法

-----  ----------------------------------------------------------------

BERT   第 18.3 节（签名 == "BERT"）

       == 引导错误记录表 ==

       如果平台提供了 RAS 支持，则必须提供此表。建议提供此表。

BOOT   签名保留（签名 == "BOOT"）

       == 简单引导标志表 ==

       仅 Microsoft 表，将不被支持。

BGRT   第 5.2.22 节（签名 == "BGRT"）

       == 引导图形资源表 ==

       可选，目前不支持，对于 ARM 服务器没有实际用例。

CPEP   第 5.2.18 节（签名 == "CPEP"）

       == 纠正平台错误轮询表 ==

       可选，目前不支持，并且在有兼容 ARM 的硬件可用且规范适当修改之前不推荐使用。

CSRT   签名保留（签名 == "CSRT"）

       == 核心系统资源表 ==

       可选，目前不支持。

DBG2   签名保留（签名 == "DBG2"）

       == 调试端口表 2 ==

       仅 Microsoft 表，将不被支持。

DBGP   签名保留（签名 == "DBGP"）

       == 调试端口表 ==

       仅 Microsoft 表，将不被支持。

DSDT   第 5.2.11.1 节（签名 == "DSDT"）

       == 差异化系统描述表 ==

       需要 DSDT；也请参阅 SSDT。

       ACPI 表仅包含一个 DSDT，但可以包含一个或多个 SSDT，它们是可选的。每个 SSDT 只能添加到 ACPI 命名空间中，但不能修改或替换 DSDT 中的任何内容。

DMAR   签名保留（签名 == "DMAR"）

       == DMA 重新映射表 ==

       仅 x86 表，将不被支持。

DRTM   签名保留（签名 == "DRTM"）

       == 测量的动态信任根表 ==

       可选，目前不支持。

ECDT   第 5.2.16 节（签名 == "ECDT"）

       == 嵌入式控制器描述表 ==

       可选，目前不支持，但在 ARM 上如果且仅当使用 GPE_BIT 字段表示 IRQ 编号时可以使用，因为在硬件精简模式下没有定义 GPE 块。这需要在 ACPI 规范中进行修改。

EINJ   第 18.6 节（签名 == "EINJ"）

       == 错误注入表 ==

       此表对于测试平台对错误条件的响应非常有用；它允许将错误注入系统，就像它实际发生一样。然而，此表不应随生产系统一起提供；仅在测试期间应使用 ACPICA 工具动态加载和执行。

ERST   第 18.5 节（签名 == "ERST"）

       == 错误记录序列化表 ==

       在支持 RAS 的平台上，如果不是基于 UEFI，则必须提供此表；如果是基于 UEFI，则可以提供此表。如果此表不存在，则将利用 UEFI 运行时服务将硬件错误信息保存到持久存储并从中检索。

ETDT   签名保留（签名 == "ETDT"）

       == 事件计时器描述表 ==

       过时的表，将不被支持。

FACS   第 5.2.10 节（签名 == "FACS"）

       == 固件 ACPI 控制结构 ==

       此表不太可能非常有用。如果提供了此表，将不使用全局锁，因为它不是硬件精简配置文件的一部分，并且仅将 64 位地址字段视为有效。

FADT   第 5.2.9 节（签名 == "FACP"）

       == 固定 ACPI 描述表 ==

       对于 arm64 是必需的。

       必须设置 HW_REDUCED_ACPI 标志。当设置 HW_REDUCED_ACPI 时，所有要忽略的字段都应设置为零。

       如果提供了 FACS 表，则应使用 X_FIRMWARE_CTRL 字段，而不是 FIRMWARE_CTRL。

       如果使用了 PSCI（建议使用），请确保正确填充 ARM_BOOT_ARCH -- 设置 PSCI_COMPLIANT 标志，并根据需要设置或清除 PSCI_USE_HVC（见表 5-37）。

       对于也必需的 DSDT，应使用 X_DSDT 字段，而不是 DSDT 字段。

FPDT   第 5.2.23 节（签名 == "FPDT"）

       == 固件性能数据表 ==

       可选，目前不支持。

GTDT   第 5.2.24 节（签名 == "GTDT"）

       == 通用定时器描述表 ==

       对于 arm64 是必需的。

HEST   第 18.3.2 节（签名 == "HEST"）

       == 硬件错误源表 ==

       在进一步定义错误源类型之前，仅使用类型 6（AER 根端口）、7（AER 端点）、8（AER 桥）或 9（通用硬件错误源）。仅在 arm64 上使用可信固件时才可能进行固件首次错误处理。

       如果平台提供了 RAS 支持，则必须提供此表。建议提供此表。

HPET   签名保留（签名 == "HPET"）

       == 高精度事件定时器表 ==

       仅 x86 表，将不被支持。

IBFT   签名保留（签名 == "IBFT"）

       == iSCSI 引导固件表 ==

       Microsoft 定义的表，支持待确定。

IVRS   签名保留（签名 == "IVRS"）

       == I/O 虚拟化报告结构 ==

       仅 x86_64（AMD）表，将不被支持。

LPIT   签名保留（签名 == "LPIT"）

       == 低功耗空闲表 ==

       截至 ACPI 5.1 仅为 x86 表；未来版本已适应用于 ARM，并为支持 ACPI 电源管理而被推荐。

MADT   第 5.2.12 节（签名 == "APIC"）

       == 多 APIC 描述表 ==

       对于 arm64 是必需的。仅应使用 GIC 中断控制器结构（类型 0xA - 0xE）。

MCFG   签名保留（签名 == "MCFG"）

       == 内存映射配置空间 ==

       如果平台支持 PCI/PCIe，则需要 MCFG 表。

MCHI   签名保留（签名 == "MCHI"）

       == 管理控制器主机接口表 ==

       可选，目前不支持。

MPST   第 5.2.21 节（签名 == "MPST"）

       == 内存电源状态表 ==

       可选，目前不支持。

MSDM   签名保留（签名 == "MSDM"）

       == Microsoft 数据管理表 ==

       仅 Microsoft 表，将不被支持。

MSCT   第 5.2.19 节（签名 == "MSCT"）

       == 最大系统特性表 ==

       可选，目前不支持。

RASF   第 5.2.20 节（签名 == "RASF"）

       == RAS 特性表 ==

       可选，目前不支持。

RSDP   第 5.2.5 节（签名 == "RSD PTR"）

       == 根系统描述指针 ==

       对于 arm64 是必需的。

RSDT   第 5.2.7 节（签名 == "RSDT"）

       == 根系统描述表 ==

       由于此表只能提供 32 位地址，在 arm64 上已弃用，将不被使用。**SBST（签名 == "SBST"）**

==智能电池子系统表==

可选，目前不支持。

**SLIC（签名 == "SLIC"）**

==软件许可表==

仅 Microsoft 表，将不被支持。

**SLIT（签名 == "SLIT"）**

==系统局部性距离信息表==

一般可选，但对于 NUMA 系统是必需的。

**SPCR（签名 == "SPCR"）**

==串行端口控制台重定向表==

arm64 必需。

**SPMI（签名 == "SPMI"）**

==服务器平台管理接口表==

可选，目前不支持。

**SRAT（签名 == "SRAT"）**

==系统资源亲和性表==

可选，但如果使用，仅读取 GICC 亲和性结构。要支持 NUMA，此表是必需的。

**SSDT（签名 == "SSDT"）**

==辅助系统描述表==

这些表是 DSDT 的延续；对于可以添加到运行系统的设备，建议使用这些表，但也可以用于将设备描述分成更易于管理的部分。

SSDT 只能添加到 ACPI 命名空间中。它不能修改或替换命名空间中已有的设备描述。

这些表是可选的。ACPI 表应该只包含一个 DSDT，但可以包含许多 SSDT。

**TCPA（签名 == "TCPA"）**

==可信计算平台联盟表==

可选，目前不支持，并且可能需要更改才能与 arm64 完全互操作。

**TPM2（签名 == "TPM2"）**

==可信平台模块 2 表==

可选，目前不支持，并且可能需要更改才能与 arm64 完全互操作。

**UEFI（签名 == "UEFI"）**

==UEFI ACPI 数据表==

可选，目前不支持。目前对于 arm64 没有已知的用例。

**WAET（签名 == "WAET"）**

==Windows ACPI 模拟设备表==

仅 Microsoft 表，将不被支持。

**WDAT（签名 == "WDAT"）**

==看门狗动作表==

仅 Microsoft 表，将不被支持。

**WDRT（签名 == "WDRT"）**

==看门狗资源表==

仅 Microsoft 表，将不被支持。

**WPBT（签名 == "WPBT"）**

==Windows 平台二进制表==

仅 Microsoft 表，将不被支持。

**XSDT（签名 == "XSDT"）**

==扩展系统描述表==

arm64 必需。

# ACPI 对象

------------

以下是关于各个 ACPI 对象的期望列表：

```
名称   章节         ARMv8 Linux 的使用情况
----   ------------    -------------------------------------------------
_ADR   6.1.1           根据需要使用。
_BBN   6.5.5           根据需要使用；PCI 特定。
_BDN   6.5.3           可选；在 arm64 上不太可能使用。
_CCA   6.2.17          对于 arm64 上的所有总线主控器都应定义此方法。虽然假定了缓存一致性，但使其明确可确保内核按应有的方式设置 DMA。
_CDM   6.2.1           可选，仅用于处理器设备。
_CID   6.1.2           根据需要使用。
_CLS   6.1.3           根据需要使用。
_CRS   6.2.2           arm64 上必需。
_DCK   6.5.2           可选；在 arm64 上不太可能使用。
_DDN   6.1.4           此字段可用于设备名称。然而，它是用于 DOS 设备名称（例如，COM1）的，因此在跨操作系统使用时要小心。
_DEP   6.5.8           根据需要使用。
_DIS   6.2.3           可选，用于电源管理。
_DLM   5.7.5           可选。
_DMA   6.2.4           可选。
_DSD   6.2.5           应谨慎使用。如果使用此对象，请尝试在设备属性 UUID 已定义的约束内使用它。仅在极少数情况下才需要创建新的 _DSD UUID。在任何情况下，都应将 _DSD 定义与任何驱动程序补丁一起提交以供讨论，特别是在使用设备属性时。没有相应的 _DSD 描述，驱动程序将不被视为完整。一旦得到内核维护者的批准，必须将 UUID 或设备属性注册到 UEFI 论坛；由于多个操作系统将注册条目，这可能会导致一些迭代。
_DSM                   不要使用此方法。它未标准化，返回值未得到充分记录，并且目前是错误的常见来源。
_DSW   7.2.1           根据需要使用；电源管理特定。
_EDL   6.3.1           可选。
_EJD   6.3.2           可选。
_EJx   6.3.3           可选。
_FIX   6.2.7           x86 特定，在 arm64 上不使用。
\_GL   5.7.1           此对象不应在硬件精简模式下使用，因此不应在 arm64 上使用。
_GLK   6.5.7           此对象需要定义全局锁；由于 arm64 在硬件精简模式下运行，因此没有全局锁。因此，不要在 arm64 上使用此对象。
\_GPE  5.3.1           此命名空间仅用于 x86。不要在 arm64 上使用它。
_GSB   6.2.7           可选。
_HID   6.1.5           根据需要使用。这是在设备探测中使用的主要对象，尽管也可以使用 _CID 和 _CLS。
_HPP   6.2.8           可选，PCI 特定。
_HPX   6.2.9           可选，PCI 特定。
_HRV   6.1.6           可选，根据需要使用以澄清设备行为；在某些情况下，这可能比 _DSD 更容易使用。
_INI   6.5.1           不是必需的，但在设置设备时可能有用，当 UEFI 将设备置于驱动程序开始探测之前可能不是其预期的状态时。
_IRC   7.2.15          根据需要使用；电源管理特定。
_LCK   6.3.4           可选。
_MAT   6.2.10          可选；也请参阅 MADT。
_MLS   6.1.7           可选，但强烈建议在国际化中使用。
_OFF   7.1.2           对于任何可以打开或关闭的设备，建议定义此方法。
_ON    7.1.3           对于任何可以打开或关闭的设备，建议定义此方法。
\_OS   5.7.3           此方法默认将返回 "Linux"（这是 Linux 上宏 ACPI_OS_NAME 的值）。可以使用命令行参数 acpi_os=<string>将其设置为其他值。
_OSC   6.2.11          此方法可以是 ACPI 中的全局方法（即，\_SB._OSC），也可以与特定设备相关联（例如，\_SB.DEV0._OSC），或者两者都有。当用作全局方法时，只允许使用 ACPI 规范中发布的功能。当用作设备特定方法时，必须使用用于使用 _DSD 的过程来创建 _OSC 定义；不允许在进程外使用 _OSC。即：
将特定设备的 _OSC 使用描述作为内核驱动程序提交的一部分提交，由内核社区批准，然后向 UEFI 论坛注册。
\_OSI 5.7.2 在 ARM64 上已弃用。对此方法的任何调用都将在控制台上打印警告并返回 false。也就是说，就 ACPI 固件而言，_OSI 不能用于确定正在使用的系统类型或提供的功能。应使用 _OSC 方法。
_OST 6.3.5 可选。
_PDC 8.4.1 已弃用，不要在 arm64 上使用。
\_PIC 5.8.1 不应使用此方法。在 arm64 上，唯一可用的中断模型是 GIC。
_PLD 6.1.8 可选。
\_PR 5.3.1 此命名空间仅在旧版系统上用于 x86。不要在 arm64 上使用它。
_PRS 6.2.12 可选。
_PRT 6.2.13 作为所有 PCI 根设备定义的一部分是必需的。
_PRW 7.2.13 根据需要使用；特定于电源管理。
_PRx 7.2.8-11 根据需要使用；特定于电源管理。如果定义了 _PR0，则也必须定义 _PR3。
_PSC 7.2.6 根据需要使用；特定于电源管理。
_PSE 7.2.7 根据需要使用；特定于电源管理。
_PSW 7.2.14 根据需要使用；特定于电源管理。
_PSx 7.2.2-5 根据需要使用；特定于电源管理。如果定义了 _PS0，则也必须定义 _PS3。如果需要调整时钟或调节器以与电源使用保持一致，请在这些方法中进行更改。
\_PTS 7.3.1 根据需要使用；特定于电源管理。
_PXM 6.2.14 可选。
_REG 6.5.4 根据需要使用。
\_REV 5.7.4 始终返回支持的 ACPI 的最新版本。
_RMV 6.3.6 可选。
\_SB 5.3.1 在 arm64 上是必需的；所有设备都必须在此命名空间中定义。
_SEG 6.5.6 根据需要使用；特定于 PCI。
\_SI 5.3.1，可选。9.1
_SLI 6.2.15 可选；当使用 SLIT 表时推荐使用。
_STA 6.3.7，对于任何可以打开或关闭的设备，建议定义此方法。7.1.4
_SRS 6.2.16 可选；也请参阅 _PRS。
_STR 6.1.10 推荐用于将设备名称传达给最终用户；这比使用 _DDN 更可取。
_SUB 6.1.9 根据需要使用；_HID 或 _CID 更受青睐。
_SUN 6.1.11 可选。
\_Sx 7.3.2 根据需要使用；特定于电源管理。
_SxD 7.2.16-19 根据需要使用；特定于电源管理。
_SxW 7.2.20-24 根据需要使用；特定于电源管理。
_SWS 7.3.3 根据需要使用；特定于电源管理；这可能需要针对 arm64 的使用进行规范更改。
\_TTS 7.3.4 根据需要使用；特定于电源管理。
\_TZ 5.3.1 可选。
_UID 6.1.12 推荐用于区分相同类别的设备；如果可能，请定义它。
\_WAK 7.3.5 根据需要使用；特定于电源管理。
```

# ACPI 事件模型

----------------

不要使用 GPE 块设备；在 arm64 使用的硬件精简配置文件中不支持这些设备。由于在 ARM 平台上未定义用于使用的 GPE 块，因此应使用 GPIO 信号中断来创建系统事件。

# ACPI 处理器控制

----------------------

ACPI 规范的第 8 节目前正在进行更改，应在规范的 6.0 版本中完成。届时，arm64 的处理器性能控制将以不同的方式处理。例如，将不使用处理器聚合设备（第 8.5 节），而是使用另一个类似的机制。

虽然 UEFI 在 ACPI 6.0 发布之前限制了我们可以说的内容，但建议使用 CPPC（8.4.5）作为主要模型。这在未来仍将有用。仍将提供 C 状态和 P 状态，但目前的大多数设计工作似乎倾向于 CPPC。

此外，ARMv8 SoC 必须提供功能齐全的 PSCI 实现；这将是 ACPI 支持的唯一控制 CPU 电源状态（包括辅助 CPU 启动）的机制。

关于 ACPI 6.0 规范的发布，将提供更多详细信息。

# ACPI 系统地址映射接口

----------------------------------

在 ACPI 规范的第 15 节中，提到了几种将内存资源信息传达给内核的可能机制。对于 arm64，我们仅支持使用 ACPI 启动的 UEFI，因此 UEFI GetMemoryMap()引导服务是唯一将使用的机制。

# ACPI 平台错误接口（APEI）

-------------------------------------

上面描述了支持的 APEI 表。

APEI 需要在 ARMv8 上具有等效的 SCI 和 NMI。SCI 用于通知 OSPM 已发生但可以纠正的错误，并且系统可以继续正常运行，即使可能降级。NMI 用于指示无法纠正的致命错误，需要立即关注。

由于没有 x86 SCI 或 NMI 的直接等效项，arm64 对此的处理略有不同。SCI 作为正常的 GPIO 信号中断处理；鉴于这些是正在报告的已纠正（或可纠正）错误，这就足够了。NMI 被模拟为可能的最高优先级 GPIO 信号中断。这意味着必须小心使用，因为可能存在更高特权级别的中断，甚至可能存在与模拟 NMI 相同优先级的中断。在 Linux 中，这种情况不应发生，但应该意识到可能会发生。

# ACPI 在 ARM64 上不支持的对象

-----------------------------------

虽然将来可能会改变，但有几类对象可以定义，但目前对 ARM 服务器通常不感兴趣。

这些不受支持：

```
       -- 第 9.2 节：环境光传感器设备
       -- 第 9.3 节：电池设备
       -- 第 9.4 节：盖子（例如，笔记本电脑盖子）
       -- 第 9.8.2 节：IDE 控制器
       -- 第 9.9 节：软盘控制器
       -- 第 9.10 节：GPE 块设备
       -- 第 9.15 节：PC/AT RTC/CMOS 设备
       -- 第 9.16 节：用户存在检测设备
       -- 第 9.17 节：I/O APIC 设备；所有 GIC 必须通过 MADT 可枚举
       -- 第 9.18 节：时间和闹钟设备（见 9.15）
```

# ACPI 尚未实现的对象

--------------------------------

虽然这些对象在 x86 上有等效项，并且在 ARM 服务器中确实有一定意义，但目前要么没有可用的硬件，要么在某些情况下可能尚未有非 ARM 实现。因此，目前尚未实现，但将来可能会改变。

尚未实现的有：

```
       -- 第 10 节：电源和功率计设备
       -- 第 11 节：热管理
       -- 第 12 节：嵌入式控制器接口
       -- 第 13 节：SMBus 接口
       -- 第 17 节：NUMA 支持（已提交原型以供审查）
```