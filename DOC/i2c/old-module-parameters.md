# I2C 设备驱动程序从用户空间的绑定控制
=================================================

在直到内核 2.6.32 之前，许多 I2C 驱动程序使用了 <linux/i2c.h> 提供的辅助宏，创建了标准的模块参数，以让用户控制驱动程序如何探测 I2C 总线并连接到设备。这些参数被称为“probe”（让驱动程序探测额外的地址）、“force”（强制将驱动程序附加到给定设备）和“ignore”（防止驱动程序探测给定地址）。

随着 I2C 子系统转换为标准的设备驱动程序绑定模型，很明显这些每个模块的参数不再需要，并且可以进行集中式实现。新的基于 sysfs 的接口在文档文件“instantiating-devices”的“方法 4：从用户空间实例化”部分中进行了描述。

以下是从旧的模块参数到新接口的映射。

**将驱动程序附加到 I2C 设备**
-----------------------------------

旧方法（模块参数）：
```
# modprobe <driver> probe=1,0x2d
# modprobe <driver> force=1,0x2d
# modprobe <driver> force_<device>=1,0x2d
```

新方法（sysfs 接口）：
```
# echo <device> 0x2d > /sys/bus/i2c/devices/i2c-1/new_device
```

**防止驱动程序附加到 I2C 设备**
---------------------------------------------------

旧方法（模块参数）：
```
# modprobe <driver> ignore=1,0x2f
```

新方法（sysfs 接口）：
```
# echo dummy 0x2f > /sys/bus/i2c/devices/i2c-1/new_device
# modprobe <driver>
```

当然，在加载驱动程序之前实例化“dummy”设备很重要。“dummy”设备将由 i2c-core 本身处理，防止其他驱动程序稍后绑定到它。如果在有问题的地址存在真实设备，并且您希望另一个驱动程序绑定到它，那么只需传递相关设备的名称而不是“dummy”。