<markdown_document>

# 6: 跟进

在这一点上，你已经遵循了到目前为止给出的指导方针，并且凭借自己的工程技能，发布了一系列完美的补丁。即使是经验丰富的内核开发人员也会犯的最大错误之一，就是认为他们的工作已经完成。事实上，发布补丁标志着进入了进程的下一个阶段，可能还有很多工作要做。

很少有补丁在首次发布时就非常好，以至于没有改进的余地。内核开发过程认识到这一事实，因此非常注重改进已发布的代码。作为该代码的作者，你将需要与内核社区合作，以确保你的代码达到内核的质量标准。不参与这个过程很可能会阻止你的补丁被纳入主线。

## 6.1: 与评审人员合作

任何重要的补丁都会在其他开发人员评审代码时收到一些评论。对于许多开发人员来说，与评审人员合作可能是内核开发过程中最令人生畏的部分。不过，如果牢记以下几点，生活会轻松很多：

- 如果你已经很好地解释了你的补丁，评审人员将理解其价值以及你为什么要费心编写它。但这种价值不会阻止他们提出一个基本问题：五年或十年后，使用包含此代码的内核进行维护会是什么样子？你可能会被要求进行的许多更改——从编码风格调整到实质性重写——都源于这样一种理解，即 Linux 在十年后仍将存在并在开发中。

- 代码评审是一项艰苦的工作，而且是一项相对没有回报的工作；人们会记住谁编写了内核代码，但很少有人会因为评审代码而获得持久的声誉。因此，评审人员可能会生气，尤其是当他们看到同样的错误一遍又一遍地出现时。如果你收到的评审似乎愤怒、侮辱或完全冒犯，不要冲动地以同样的方式回应。代码评审是关于代码的，而不是关于人的，代码评审人员不是在攻击你个人。

- 同样，代码评审人员也不会以牺牲你的利益为代价来推动他们雇主的议程。内核开发人员通常希望在几年后仍在从事内核工作，但他们明白他们的雇主可能会发生变化。几乎无一例外，他们真正在努力创建他们能创建的最好的内核；他们不是在试图给他们雇主的竞争对手制造麻烦。

所有这些归结起来就是，当评审人员向你发送评论时，你需要关注他们提出的技术观察。不要让他们的表达方式或你自己的骄傲阻止你这样做。当你收到关于补丁的评审评论时，花时间理解评审人员试图说什么。如果可能的话，修复评审人员要求你修复的问题。并回复评审人员：感谢他们，并描述你将如何回答他们的问题。

请注意，你不必同意评审人员提出的每一个更改。如果你认为评审人员误解了你的代码，解释实际情况是什么。如果你对建议的更改有技术上的反对意见，描述它并证明你对问题的解决方案是合理的。如果你的解释有道理，评审人员将接受它们。然而，如果你的解释不能令人信服，尤其是如果其他人开始同意评审人员的意见，花些时间再次思考一下。很容易被自己对问题的解决方案蒙蔽双眼，以至于没有意识到某些事情根本是错误的，或者也许你甚至没有解决正确的问题。

Andrew Morton 建议，每一个没有导致代码更改的评审评论都应该导致一个额外的代码注释；这可以帮助未来的评审人员避免第一次出现的问题。

一个致命的错误是希望评审评论会消失而忽略它们。它们不会消失。如果你在没有回复之前收到的评论的情况下重新发布代码，你很可能会发现你的补丁无处可去。

说到重新发布代码：请记住，评审人员不会记住你上次发布的代码的所有细节。因此，提醒评审人员之前提出的问题以及你如何处理它们总是一个好主意；补丁更改日志是此类信息的好地方。评审人员不应该不得不通过搜索列表存档来熟悉上次所说的内容；如果你帮助他们有一个良好的开端，他们在重新审视你的代码时会心情更好。

如果您已经尽力做对了一切，但事情仍然没有进展怎么办？大多数技术分歧可以通过讨论来解决，但有时必须有人做出决定。如果你诚实地认为这个决定是错误地对你不利，你总是可以尝试向上级申诉。截至本文撰写时，那个上级往往是 Andrew Morton。Andrew 在内核开发社区中受到极大的尊重；他经常能够解决看似无望的阻塞情况。然而，不要轻易向 Andrew 申诉，并且在探索了所有其他替代方案之前不要这样做。当然，也要记住，他也可能不同意你的意见。

## 6.2: 接下来会发生什么

如果一个补丁被认为是添加到内核中的好东西，并且一旦解决了大多数评审问题，下一步通常是进入子系统维护者的树。这在不同的子系统中如何工作有所不同；每个维护者都有自己的做事方式。特别是，可能有多个树——一个可能专门用于下一个合并窗口计划的补丁，另一个用于长期工作。

对于适用于没有明显子系统树的区域的补丁（例如内存管理补丁），默认树通常最终是 -mm。影响多个子系统的补丁也可能最终通过 -mm 树。

纳入子系统树可以为补丁带来更高的可见性。现在，使用该树的其他开发人员将默认获得该补丁。子系统树通常也会提供给 linux-next，使其内容对整个开发社区可见。在这一点上，很有可能你会从一组新的评审人员那里得到更多的评论；这些评论需要像上一轮一样得到回答。

根据你的补丁的性质，此时也可能会出现与其他人正在做的工作的冲突。在最坏的情况下，严重的补丁冲突可能会导致一些工作被搁置，以便将剩余的补丁整理并合并。其他时候，冲突解决将涉及与其他开发人员合作，并可能在树之间移动一些补丁，以确保一切都能干净地应用。这项工作可能很痛苦，但要庆幸：在 linux-next 树出现之前，这些冲突通常只在合并窗口期间出现，必须匆忙解决。现在，它们可以在合并窗口打开之前从容解决。

总有一天，如果一切顺利，你登录时会看到你的补丁已被合并到主线内核中。恭喜！然而，庆祝活动结束后（并且你已将自己添加到 MAINTAINERS 文件中），值得记住一个重要的小事实：工作仍未完成。合并到主线带来了自己的挑战。

首先，你的补丁的可见性再次增加。可能会有一轮新的评论来自之前不知道该补丁的开发人员。忽略它们可能很诱人，因为你的代码是否被合并已经不再有任何疑问。然而，要抵制这种诱惑；你仍然需要对有问题或建议的开发人员做出回应。

更重要的是：纳入主线将你的代码交到了更大的测试人员群体手中。即使你为尚未可用的硬件贡献了一个驱动程序，你也会惊讶于有多少人会将你的代码构建到他们的内核中。当然，有测试人员的地方就会有错误报告。

最糟糕的错误报告是回归。如果你的补丁导致回归，你会发现有很多双眼睛盯着你；回归需要尽快修复。如果你不愿意或无法修复回归（并且没有人替你修复），你的补丁几乎肯定会在稳定期被删除。除了否定你为将补丁纳入主线所做的所有工作之外，由于未能修复回归而导致补丁被撤回很可能会使你在未来更难将工作合并。

处理完任何回归之后，可能还有其他普通错误需要处理。稳定期是你修复这些错误并确保你的代码在主线内核发布中的首次亮相尽可能稳固的最佳机会。因此，请回复错误报告，并在可能的情况下修复问题。这就是稳定期的目的；在处理完旧补丁的任何问题后，你可以开始创建很酷的新补丁。

并且不要忘记，还有其他里程碑也可能会导致错误报告：下一个主线稳定版本，当重要的发行商采用包含你的补丁的内核版本等。继续回复这些报告是对你的工作基本自豪感的体现。然而，如果这不是足够的动力，还值得考虑的是，开发社区会记住那些在代码合并后对其失去兴趣的开发人员。下次你发布补丁时，他们将在假设你不会在之后维护它的情况下评估它。

## 6.3: 其他可能发生的事情

有一天，你可能会打开你的邮件客户端，看到有人向你的代码发送了一个补丁。毕竟，让你的代码公开有一个好处就是这样。如果你同意这个补丁，你可以将其转发给子系统维护者（确保包含正确的 From: 行，以便正确归因，并添加你自己的签名），或者发送一个 Acked-by: 响应并让原始发布者向上发送。

如果你不同意这个补丁，发送一个礼貌的回复解释原因。如果可能的话，告诉作者需要进行哪些更改才能使补丁被你接受。对于被代码的作者和维护者反对的补丁，合并存在一定的阻力，但也只是到此为止。如果你被视为不必要地阻止了好的工作，这些补丁最终会绕过你并进入主线。在 Linux 内核中，没有人对任何代码拥有绝对的否决权。也许除了 Linus。

在非常罕见的情况下，你可能会看到完全不同的情况：另一个开发人员针对你的问题发布了不同的解决方案。在这种情况下，很可能其中一个补丁不会被合并，并且“我的是先在这里的”不被认为是一个有说服力的技术论点。如果别人的补丁取代了你的并进入了主线，实际上只有一种回应方式：为你的问题得到解决而高兴，并继续你的工作。以这种方式被推到一边可能会让人受伤和沮丧，但社区在很久以后忘记了实际上合并了谁的补丁时，会记住你的反应。

</markdown_document>