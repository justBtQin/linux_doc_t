<markdown_document>

# EARLY-STAGE PLANNING

当考虑一个 Linux 内核开发项目时，很容易直接开始编码。然而，就像任何重要项目一样，在编写第一行代码之前，最好先打好成功的基础。在早期规划和沟通上花一些时间可以在以后节省更多的时间。

## 3.1: SPECIFYING THE PROBLEM

像任何工程项目一样，一个成功的内核增强始于对要解决的问题的清晰描述。在某些情况下，这一步很容易，例如当需要为特定硬件编写驱动程序时。然而，在其他情况下，很容易将实际问题与提议的解决方案混淆，这可能会导致困难。

考虑一个例子：几年前，从事 Linux 音频工作的开发人员寻求一种方法，以避免应用程序因系统中的过度延迟而出现丢失或其他伪影。他们提出的解决方案是一个旨在挂钩到 Linux 安全模块（LSM）框架的内核模块；这个模块可以配置为让特定应用程序访问实时调度程序。这个模块被实现并发送到 linux-kernel 邮件列表，立即遇到了问题。

对于音频开发人员来说，这个安全模块足以解决他们的 immediate 问题。然而，对于更广泛的内核社区来说，它被视为对 LSM 框架的滥用（LSM 框架并非旨在赋予进程它们原本没有的特权），并且对系统稳定性构成威胁。他们的首选解决方案包括短期内通过 rlimit 机制进行实时调度访问，长期内进行持续的延迟减少工作。

然而，音频社区无法超越他们已经实现的特定解决方案；他们不愿意接受替代方案。由此产生的分歧让这些开发人员对整个内核开发过程感到失望；其中一人回到音频列表并发布了以下内容：

有很多非常优秀的 Linux 内核开发人员，但他们往往会被一大群傲慢的傻瓜所掩盖。试图向这些人传达用户需求是浪费时间。他们太“聪明”了，不愿意听取小人物的意见。

（http://lwn.net/Articles/131776/）。

实际情况有所不同；内核开发人员更关心系统稳定性、长期维护以及找到解决问题的正确方法，而不是特定的模块。这个故事的寓意是专注于问题——而不是特定的解决方案——并在投入创建大量代码之前与开发社区进行讨论。

所以，当考虑一个内核开发项目时，应该回答以下一组问题：

- 确切地说，需要解决的问题是什么？

- 受此问题影响的用户是谁？解决方案应该解决哪些用例？

- 内核在解决该问题方面目前存在哪些不足？

只有这样，才可以开始考虑可能的解决方案。

## 3.2: EARLY DISCUSSION

在规划一个内核开发项目时，在开始实现之前与社区进行讨论是很有意义的。早期的沟通可以在许多方面节省时间和麻烦：

- 很可能内核已经以您尚未理解的方式解决了问题。Linux 内核很大，有许多功能和功能并不立即明显。并非所有内核功能都有您希望的那样记录良好，很容易错过一些东西。作者已经看到了一个完整驱动程序的发布，该驱动程序复制了一个新作者不知道的现有驱动程序。重新发明现有轮子的代码不仅是浪费的；它也不会被主线内核接受。

- 提议的解决方案中可能有一些元素对于主线合并是不可接受的。在编写代码之前发现这样的问题更好。

- 其他开发人员完全有可能已经考虑过这个问题；他们可能有更好的解决方案的想法，并且可能愿意帮助创建该解决方案。

多年的内核开发社区经验已经教会了一个明确的教训：在闭门造车设计和开发的内核代码中，总是存在只有在将代码发布到社区时才会暴露的问题。有时这些问题很严重，需要数月或数年的努力才能使代码达到内核社区的标准。一些例子包括：

- Devicescape 网络栈是为单处理器系统设计和实现的。在使其适合多处理器系统之前，它无法合并到主线中。在代码中添加锁定等是一项艰巨的任务；结果，此代码（现在称为 mac80211）的合并被推迟了一年多。

- Reiser4 文件系统包含一些功能，在核心内核开发人员看来，这些功能应该在虚拟文件系统层中实现。它还包括一些如果不使系统容易受到用户引起的死锁影响就无法轻松实现的功能。这些问题的后期暴露——以及对其中一些问题的拒绝解决——导致 Reiser4 一直未进入主线内核。

- AppArmor 安全模块以被认为不安全和不可靠的方式使用了内部虚拟文件系统数据结构。这种担忧（以及其他担忧）使得 AppArmor 多年来一直未进入主线。

在每种情况下，如果在早期与内核开发人员进行一些讨论，都可以避免大量的痛苦和额外工作。

## 3.3: WHO DO YOU TALK TO?

当开发人员决定将他们的计划公开时，下一个问题将是：我们从哪里开始？答案是找到正确的邮件列表和正确的维护者。对于邮件列表，最好的方法是在 MAINTAINERS 文件中查找相关的发布位置。如果有合适的子系统列表，在那里发布通常比在 linux-kernel 上发布更可取；您更有可能联系到具有相关子系统专业知识的开发人员，并且环境可能更支持。

找到维护者可能有点困难。同样，MAINTAINERS 文件是开始的地方。然而，该文件往往并不总是最新的，并非所有子系统都在那里表示。MAINTAINERS 文件中列出的人实际上可能不是当前在该角色中行事的人。因此，当不确定联系谁时，一个有用的技巧是使用 git（特别是“git log”）来查看当前在感兴趣的子系统中活跃的人。查看谁在编写补丁，以及是否有任何人在这些补丁上附加了 Signed-off-by 行。那些人将最有能力帮助新的开发项目。

找到正确的维护者有时具有足够的挑战性，以至于内核开发人员添加了一个脚本来简化这个过程：

.../scripts/get_maintainer.pl

当使用“-f”选项时，此脚本将返回给定文件或目录的当前维护者。如果在命令行上传递一个补丁，它将列出可能应该收到该补丁副本的维护者。有许多选项可以调节 get_maintainer.pl 查找维护者的难度；请小心使用更激进的选项，因为您可能最终会包括对您正在修改的代码没有真正兴趣的开发人员。

如果所有其他方法都失败了，与 Andrew Morton 交谈可能是追踪特定代码的维护者的有效方法。

## 3.4: WHEN TO POST?

如果可能的话，在早期阶段发布您的计划只会有帮助。描述要解决的问题以及关于如何实施的任何计划。您可以提供的任何信息都可以帮助开发社区对项目提供有用的输入。

在这个阶段可能会发生一件令人沮丧的事情，不是敌对的反应，而是很少或根本没有反应。可悲的事实是（1）内核开发人员往往很忙，（2）不缺有宏伟计划但几乎没有代码（甚至没有代码前景）来支持它们的人，（3）没有人有义务审查或评论他人发布的想法。除此之外，高级设计经常隐藏只有在有人实际尝试实现这些设计时才会被审查的问题；出于这个原因，内核开发人员更愿意看到代码。

如果一个请求评论的帖子几乎没有收到评论，不要假设这意味着对项目没有兴趣。不幸的是，您也不能假设您的想法没有问题。在这种情况下，最好的做法是继续进行，在进行过程中让社区了解情况。

## 3.5: GETTING OFFICIAL BUY-IN

如果您的工作是在企业环境中进行的——就像大多数 Linux 内核工作一样——显然，在将公司的计划或代码发布到公共邮件列表之前，必须获得有适当授权的经理的许可。发布未经 GPL 兼容许可证批准发布的代码可能特别成问题；公司的管理层和法律人员越早就发布内核开发项目达成一致，对所有相关人员就越好。

此时，一些读者可能会认为他们的内核工作旨在支持尚未得到官方承认的产品。在公共邮件列表上披露他们雇主的计划可能不是一个可行的选择。在这种情况下，值得考虑保密是否真的必要；通常没有真正的需要将开发计划保密。

也就是说，也有一些情况，公司在开发过程的早期合法地无法披露其计划。有经验的内核开发人员的公司可能会以开环方式进行，假设他们以后能够避免严重的集成问题。对于没有这种内部专业知识的公司，最好的选择通常是聘请外部开发人员在保密协议下审查计划。Linux 基金会运营一个 NDA 计划，旨在帮助解决这种情况；更多信息可以在以下位置找到：

http://www.linuxfoundation.org/en/NDA_program

这种审查通常足以避免以后的严重问题，而无需公开披露项目。

</markdown_document>