<markdown_document>

# A GUIDE TO THE KERNEL DEVELOPMENT PROCESS

本文档的目的是帮助开发人员（及其经理）以最小的挫折感与开发社区合作。它试图以一种非 Linux 内核开发（或实际上一般的自由软件开发）的亲密熟悉者可以访问的方式记录这个社区的工作方式。虽然这里有一些技术材料，但这主要是一个面向过程的讨论，不需要深入了解内核编程即可理解。

## 1.1: EXECUTIVE SUMMARY

本节的其余部分涵盖了内核开发过程的范围以及开发人员及其雇主可能遇到的各种挫折。将内核代码合并到官方（“主线”）内核中有很多原因，包括对用户的自动可用性、多种形式的社区支持以及影响内核开发方向的能力。贡献给 Linux 内核的代码必须根据与 GPL 兼容的许可证提供。

第 2 节介绍了开发过程、内核发布周期和合并窗口的机制。涵盖了补丁开发、审查和合并周期的各个阶段。讨论了一些工具和邮件列表。鼓励希望开始内核开发的开发人员首先查找和修复错误。

第 3 节涵盖了早期项目规划，重点是尽快让开发社区参与。

第 4 节是关于编码过程；讨论了其他开发人员遇到的一些陷阱。涵盖了补丁的一些要求，并介绍了一些可以帮助确保内核补丁正确的工具。

第 5 节讨论了发布补丁以供审查的过程。为了得到开发社区的认真对待，补丁必须格式正确并描述清楚，并且必须发送到正确的位置。遵循本节中的建议应该有助于确保您的工作得到最好的接受。

第 6 节涵盖了发布补丁后的情况；在这一点上，工作远未完成。与审查者合作是开发过程的关键部分；本节提供了一些关于如何在这个重要阶段避免问题的提示。告诫开发人员不要以为当补丁合并到主线时工作就完成了。

第 7 节介绍了几个“高级”主题：使用 git 管理补丁和审查他人发布的补丁。

第 8 节以指向内核开发更多信息来源的指针结束本文档。

## 1.2: WHAT THIS DOCUMENT IS ABOUT

Linux 内核，代码超过 800 万行，每个版本有 1000 多名贡献者，是现存最大和最活跃的自由软件项目之一。自 1991 年不起眼的开始以来，这个内核已经演变成一个一流的操作系统组件，在袖珍数字音乐播放器、台式机 PC、现存最大的超级计算机以及介于两者之间的所有类型的系统上运行。它是一种健壮、高效和可扩展的解决方案，适用于几乎任何情况。

随着 Linux 的增长，希望参与其开发的开发人员（和公司）数量也在增加。硬件供应商希望确保 Linux 能够很好地支持他们的产品，使这些产品对 Linux 用户具有吸引力。嵌入式系统供应商将 Linux 用作集成产品的组件，希望 Linux 能够尽可能胜任并适合手头的任务。基于 Linux 的分销商和其他软件供应商对 Linux 内核的功能、性能和可靠性有明确的兴趣。最终用户也经常希望更改 Linux 以使其更好地满足他们的需求。

Linux 最引人注目的特点之一是它对这些开发人员是可访问的；任何具有必要技能的人都可以改进 Linux 并影响其发展方向。专有产品无法提供这种开放性，这是自由软件过程的一个特点。但是，如果有什么不同的话，内核比大多数其他自由软件项目更加开放。一个典型的三个月内核开发周期可以涉及 1000 多名开发人员为 100 多家不同的公司（或根本不为任何公司）工作。

与内核开发社区合作并不特别困难。但是，尽管如此，许多潜在的贡献者在尝试进行内核工作时遇到了困难。内核社区已经发展出自己独特的运作方式，使其能够在每天更改数千行代码的环境中平稳运行（并生产出高质量的产品）。因此，Linux 内核开发过程与专有开发方法有很大不同并不奇怪。

对于新开发人员来说，内核的开发过程可能看起来很奇怪和令人生畏，但它背后有很好的理由和坚实的经验。不了解内核社区方式的开发人员（或者更糟糕的是，试图违反或规避它们的开发人员）将面临令人沮丧的经历。开发社区虽然对那些试图学习的人很有帮助，但对那些不听或不在乎开发过程的人却没有时间。

希望阅读本文档的人能够避免这种令人沮丧的经历。这里有很多材料，但阅读它所涉及的努力将很快得到回报。开发社区始终需要能够帮助使内核更好的开发人员；以下文本应该帮助您 - 或您为之工作的人 - 加入我们的社区。

## 1.3: CREDITS

本文档由 Jonathan Corbet 撰写，corbet@lwn.net。它已通过 Johannes Berg、James Berry、Alex Chiang、Roland Dreier、Randy Dunlap、Jake Edge、Jiri Kosina、Matt Mackall、Arthur Marsh、Amanda McPherson、Andrew Morton、Andrew Price、Tsugikazu Shibata 和 Jochen Voß 的评论得到改进。

这项工作得到了 Linux 基金会的支持；特别感谢 Amanda McPherson，她看到了这项努力的价值并使其得以实现。

## 1.4: THE IMPORTANCE OF GETTING CODE INTO THE MAINLINE

一些公司和开发人员偶尔会想，为什么他们应该费心学习如何与内核社区合作并将其代码合并到主线内核中（“主线”是 Linus Torvalds 维护的内核，是 Linux 分发版的基础）。在短期内，贡献代码看起来像是一种可以避免的开销；似乎更容易将代码分开并直接支持用户。事实是，将代码分开（“树外”）是一种虚假的经济。

为了说明树外代码的成本，这里是内核开发过程的一些相关方面；其中大部分将在本文档的后面更详细地讨论。考虑：

- 已合并到主线内核中的代码可供所有 Linux 用户使用。它将自动在启用它的所有分发版上存在。无需驱动程序磁盘、下载或支持多个分发版的多个版本的麻烦；对于开发人员和用户来说，一切都可以正常工作。合并到主线中解决了大量的分发和支持问题。

- 虽然内核开发人员努力维护与用户空间的稳定接口，但内核内部 API 不断变化。缺乏稳定的内部接口是一个有意的设计决策；它允许随时进行根本改进并产生更高质量的代码。但该政策的一个结果是，任何树外代码如果要与新内核一起工作，都需要不断维护。维护树外代码需要大量工作才能使该代码正常工作。

相反，主线中的代码不需要这项工作，因为有一个简单的规则，即任何进行 API 更改的开发人员都必须修复由于该更改而损坏的任何代码。因此，已合并到主线中的代码的维护成本要低得多。

- 除此之外，内核中的代码通常会被其他开发人员改进。让您的用户社区和客户改进您的产品可以带来令人惊讶的结果。

- 内核代码在合并到主线之前和之后都会受到审查。无论原始开发人员的技能有多强，这个审查过程总是会找到可以改进代码的方法。通常，审查会发现严重的错误和安全问题。对于在封闭环境中开发的代码尤其如此；这种代码从外部开发人员的审查中受益匪浅。树外代码是质量较低的代码。

- 参与开发过程是影响内核开发方向的方式。在一旁抱怨的用户会被听到，但积极的开发人员有更强的声音 - 并且有能力实施更改，使内核更好地满足他们的需求。

- 当代码单独维护时，总是存在第三方将为类似功能贡献不同实现的可能性。如果发生这种情况，将您的代码合并将变得更加困难 - 甚至不可能。然后，您将面临要么（1）无限期地在树外维护非标准功能，要么（2）放弃您的代码并将您的用户迁移到树内版本的不愉快选择。

- 代码贡献是使整个过程正常工作的基本动作。通过贡献您的代码，您可以向内核添加新功能，并提供对其他内核开发人员有用的功能和示例。如果您已经为 Linux 开发了代码（或正在考虑这样做），您显然对这个平台的持续成功感兴趣；贡献代码是帮助确保成功的最佳方式之一。

上述所有推理都适用于任何树外内核代码，包括以专有、仅二进制形式分发的代码。但是，在考虑任何类型的仅二进制内核代码分发之前，应该考虑其他因素。这些包括：

- 围绕专有内核模块分发的法律问题充其量是模糊的；相当多的内核版权所有者认为，大多数仅二进制模块是内核的衍生产品，因此，它们的分发违反了 GNU 通用公共许可证（下面将详细介绍）。作者不是律师，本文档中的任何内容都不能被视为法律建议。封闭源模块的真实法律地位只能由法院确定。但是，无论如何，困扰这些模块的不确定性都存在。

- 二进制模块极大地增加了调试内核问题的难度，以至于大多数内核开发人员甚至不会尝试。因此，仅二进制模块的分发将使您的用户更难从社区获得支持。

- 对于仅二进制模块的分发者来说，支持也更加困难，他们必须为他们希望支持的每个分发版和每个内核版本提供一个模块版本。为了提供合理全面的覆盖，可能需要单个模块的数十个构建，并且您的用户每次升级他们的内核时都必须单独升级您的模块。

- 上面关于代码审查的所有内容都适用于封闭源代码。由于此代码根本不可用，因此它不能由社区进行审查，并且无疑将存在严重问题。

嵌入式系统的制造商尤其可能倾向于忽视本节中所说的大部分内容，认为他们正在运送一个独立的产品，该产品使用冻结的内核版本，并且在发布后不需要更多的开发。这个论点忽略了广泛的代码审查的价值以及允许您的用户为您的产品添加功能的价值。但是，这些产品也有有限的商业寿命，之后必须发布新版本。在这一点上，其代码在主线中且维护良好的供应商将更有能力快速将新产品推向市场。

## 1.5: LICENSING

代码以多种许可证贡献给 Linux 内核，但所有代码必须与 GNU 通用公共许可证（GPLv2）第 2 版兼容，该许可证涵盖了整个内核分发。实际上，这意味着所有代码贡献都受 GPLv2（可选地，允许在 GPL 的后续版本下分发的语言）或三条款 BSD 许可证的覆盖。任何不受兼容许可证覆盖的贡献都不会被接受进入内核。

对内核贡献的代码不需要（或不要求）版权转让。合并到主线内核中的所有代码都保留其原始所有权；结果，内核现在有数千个所有者。

这种所有权结构的一个含义是，任何更改内核许可证的尝试都注定几乎肯定会失败。在实际情况下，几乎不可能获得所有版权所有者的同意（或从内核中删除他们的代码）。因此，特别是在可预见的未来，没有迁移到 GPL 第 3 版的前景。

至关重要的是，贡献给内核的所有代码必须是合法的自由软件。出于这个原因，来自匿名（或假名）贡献者的代码将不被接受。所有贡献者都需要在其代码上“签署”，声明该代码可以与内核一起在 GPL 下分发。未经其所有者许可为自由软件许可的代码，或可能给内核带来版权相关问题的代码（例如源自缺乏适当保障措施的逆向工程工作的代码）不能被贡献。

关于版权相关问题的问题在 Linux 开发邮件列表中很常见。这些问题通常不会缺乏答案，但应该记住，回答这些问题的人不是律师，不能提供法律建议。如果您有与 Linux 源代码相关的法律问题，没有什么可以替代与了解该领域的律师交谈。依赖在技术邮件列表上获得的答案是一件冒险的事情。

</markdown_document>