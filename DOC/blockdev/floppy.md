此文件描述了软盘驱动程序。

常见问题解答列表：

=========

常见问题解答列表可在`fdutils`包中找到（见下文），也可在<http://fdutils.linux.lu/faq.html>获取。

# LILO 配置选项（Thinkpad 用户，请阅读此内容）

======================================================

软盘驱动程序使用`lilo`中的`floppy=`选项进行配置。此选项可在引导提示符下输入，或在`lilo`配置文件中输入。

示例：如果您的内核名为`linux-2.6.9`，请在`lilo`引导提示符下输入以下行（如果您有一台 Thinkpad）：

`linux-2.6.9 floppy=thinkpad`

您也可以在`/etc/lilo.conf`中`linux-2.6.9`的描述中输入以下行：

`append = "floppy=thinkpad"`

可以给出几个与软盘相关的选项，例如：

`linux-2.6.9 floppy=daring floppy=two_fdc`

`append = "floppy=daring floppy=two_fdc"`

如果您在`lilo`配置文件和引导提示符中都给出了选项，那么这两个地方的选项字符串将被连接，引导提示符选项最后出现。这就是为什么也有恢复默认行为的选项。

# 模块配置选项

============================

如果您将软盘驱动程序用作模块，请使用以下语法：

`modprobe floppy floppy="<选项>"`

示例：

`modprobe floppy floppy="omnibook messages"`

如果您需要在每次加载软盘驱动程序时启用某些选项，可以在`/etc/modprobe.d/`中的配置文件中放入：

`options floppy floppy="omnibook messages"`

与软盘驱动程序相关的选项有：

`floppy=asus_pci`

设置位掩码以仅允许单元 0 和 1。（默认）

`floppy=daring`

告诉软盘驱动程序您有一个行为良好的软盘控制器。这允许更高效和更平稳的操作，但在某些控制器上可能会失败。这可能会加快某些操作的速度。

`floppy=0,daring`

告诉软盘驱动程序您应谨慎使用软盘控制器。

`floppy=one_fdc`

告诉软盘驱动程序您只有一个软盘控制器。（默认）

`floppy=two_fdc`

`floppy=<地址>,two_fdc`

告诉软盘驱动程序您有两个软盘控制器。第二个软盘控制器假定位于`<地址>`。如果第二个控制器位于地址 0x370，并且您使用`cmos`选项，则不需要此选项。

`floppy=thinkpad`

告诉软盘驱动程序您有一台 Thinkpad。Thinkpads 对磁盘更改线使用反转约定。

`floppy=0,thinkpad`

告诉软盘驱动程序您没有 Thinkpad。

`floppy=omnibook`

`floppy=nodma`

告诉软盘驱动程序不要在数据传输中使用 Dma。这在 HP Omnibooks 上是必需的，因为它们没有适用于软盘驱动程序的可用 DMA 通道。如果您经常收到“无法分配 DMA 内存”消息，此选项也很有用。实际上，dma 内存需要在物理内存中连续，因此更难找到，而非 dma 缓冲区可以在虚拟内存中分配。然而，如果您有一个没有 FIFO（8272A 或 82072）的 FDC，我建议不要使用此选项。82072A 及更高版本可以。您还需要至少一个 486 才能使用 nodma。如果您使用 nodma 模式，我建议您也将 FIFO 阈值设置为 10 或更低，以限制数据传输中断的次数。如果您有一个可使用 FIFO 的 FDC，软盘驱动程序会在找不到可使用 DMA 的内存时自动回退到非 DMA 模式。如果您想避免这种情况，请明确要求`yesdma`。

`floppy=yesdma`

告诉软盘驱动程序有一个可用的工作 DMA 通道。（默认）

`floppy=nofifo`

完全禁用 FIFO。如果您在访问软盘时从以太网卡（或其他设备）收到“总线主仲裁错误”消息，则需要此选项。

`floppy=usefifo`

启用 FIFO。（默认）

`floppy=<阈值>,fifo_depth`

设置 FIFO 阈值。这在 DMA 模式下最为相关。如果此值较高，软盘驱动程序可以容忍更多的中断延迟，但会触发更多的中断（即对系统的其他部分施加更多的负载）。如果此值较低，中断延迟也应该较低（处理器更快）。较低阈值的好处是中断较少。要调整 FIFO 阈值，请使用`floppycontrol --messages`打开溢出/下溢消息。然后访问软盘。如果您收到大量“溢出/下溢 - 重试”消息，则 FIFO 阈值太低。尝试使用更高的值，直到您只偶尔收到溢出/下溢。在进行此调整时，将软盘驱动程序编译为模块是一个好主意。实际上，它允许在不每次测试都重新启动机器的情况下尝试不同的 FIFO 值。请注意，每次重新插入模块时都需要执行`floppycontrol --messages`。通常，调整 FIFO 阈值不应是必需的，因为默认值（0xa）是合理的。

`floppy=<驱动器>,<类型>,cmos`

将`<驱动器>`的 CMOS 类型设置为`<类型>`。如果您有两个以上的软盘驱动器（物理 CMOS 中只能描述两个），或者您的 BIOS 使用非标准 CMOS 类型，这是必需的。CMOS 类型如下：

`0 - 使用物理 CMOS 的值`

`1 - 5 1/4 双密度`

`2 - 5 1/4 高密`

`3 - 3 1/2 双密度`

`4 - 3 1/2 高密`

`5 - 3 1/2 增强密度`

`6 - 3 1/2 增强密度`

`16 - 未知或未安装`

（注意：对于 ED 驱动器，有两种有效的类型。这是因为最初选择 5 来表示软盘*磁带*，6 表示 ED 驱动器。AMI 忽略了这一点，并将 5 用于 ED 驱动器。这就是为什么软盘驱动程序同时处理这两种情况。）

`floppy=unexpected_interrupts`

当收到意外中断时打印警告消息。（默认）

`floppy=no_unexpected_interrupts`

`floppy=L40SX`

当收到意外中断时不打印消息。这在某些视频模式下的 IBM L40SX 笔记本电脑上是必需的。（似乎视频和软盘之间存在交互作用。意外中断仅影响性能，可以安全地忽略。）

`floppy=broken_dcl`

不使用磁盘更改线，但在每次重新打开设备节点时假定磁盘已更改。在某些磁盘更改线损坏或不受支持的盒子上需要此选项。这应被视为一种权宜之计，因为它会由于不必要的缓存刷新而使软盘操作效率降低，并且稍微不太可靠。如果您有任何 DCL 问题，请验证您的电缆、连接和跳线设置。然而，一些较旧的驱动器以及一些笔记本电脑已知没有 DCL。

`floppy=debug`

打印调试消息。

`floppy=messages`

为某些操作打印信息消息（磁盘更改通知、关于溢出和下溢的警告以及关于自动检测的消息）。

`floppy=silent_dcl_clear`

使用一种不太嘈杂的方式清除磁盘更改线（不涉及寻道）。`daring`选项隐含此设置。

`floppy=<nr>,irq`

将软盘 IRQ 设置为`<nr>`而不是 6。

`floppy=<nr>,dma`

将软盘 DMA 通道设置为`<nr>`而不是 2。

`floppy=slow`

使用 PS/2 步进速率：

“PS/2 软盘的步进速率比常规软盘慢得多。在某些更极端的情况下，建议采用默认速度的 1/4。”

# 支持工具和附加文档：

==================================================

软盘驱动程序的其他参数可以在运行时进行配置。执行此操作的工具可在`fdutils`包中找到。此包还包含新版本的`mtools`，允许访问大容量磁盘（在高密度 3 1/2 磁盘上最多可达 1992K！）。它还包含有关软盘驱动程序的附加文档。

最新版本可在`fdutils`主页找到：

http://fdutils.linux.lu

`fdutils`版本可在以下位置找到：

http://fdutils.linux.lu/download.html

http://www.tux.org/pub/knaff/fdutils/

ftp://metalab.unc.edu/pub/Linux/utils/disk-management/

# 报告软盘驱动程序的问题

==========================================

如果您对软盘驱动程序有疑问或错误报告，请发送邮件至 Alain.Knaff@poboxes.com。如果你在 Usenet 上发帖，最好使用`comp.os.linux.hardware`。由于这些组中的信息量相当大，务必在主题行中包含“floppy”（或“FLOPPY”）一词。如果报告的问题发生在挂载软盘时，务必在主题行中也提及文件系统的类型。在发送/张贴任何错误报告之前，请务必阅读常见问题解答！

Alain

更改日志

=========

2004 年 10 月 30 日：清理、更新，添加对模块配置的引用。

James Nelson <james4765@gmail.com>

2000 年 6 月 3 日：原始文档