这描述了 DRBD-9 的内核数据结构。从 Linux v3.14 开始，我们正在重新组织 DRBD 以使用此数据结构。

# 基本数据结构

====================

一个节点有多个 DRBD 资源。每个这样的资源有多个设备（也称为卷）以及与其他节点（“对等节点”）的连接。每个 DRBD 设备在本地由一个块设备表示。

DRBD 对象相互连接形成一个如下所示的矩阵；在 drbd_device 和 drbd_connection 之间的每个交点处都有一个 drbd_peer_device 对象：

```
  /--------------+---------------+.....+---------------\
  |   资源   |    设备     |     |    设备     |
  +--------------+---------------+.....+---------------+
  |  连接  |  对等设备  |     |  对等设备  |
  +--------------+---------------+.....+---------------+
  :              :               :     :               :
  :              :               :     :               :
  +--------------+---------------+.....+---------------+
  |  连接  |  对等设备  |     |  对等设备  |
  \--------------+---------------+.....+---------------/
```

在这个表中，水平方向上，设备可以通过其卷号从资源中访问。同样，对等设备可以通过其卷号从连接中访问。垂直方向上的对象通过双向链表连接。从对等设备到其连接和设备有反向指针，从连接和设备到其资源也有反向指针。

所有资源都在 drbd_resources 双向链表中。此外，所有设备都可以通过其次要设备号通过 drbd_devices idr 访问。drbd_resource、drbd_connection 和 drbd_device 对象是引用计数的。对等设备对象仅用于在设备和连接之间建立链接；它们的生命周期由它们引用的设备和连接的生命周期决定。