# 29 调试器适配器协议

调试器适配器协议是一个通用的 API，一些集成开发环境（IDE）使用它与调试器进行通信。它在 https://microsoft.github.io/debug-adapter-protocol/ 上有文档记录。

一般来说，gdb 会按照编写的方式实现调试器适配器协议。然而，在某些情况下，需要甚至期望有扩展。

gdb 定义了一些可以传递给启动请求的参数：

```
args 	
	如果提供，这应该是一个字符串数组。这些字符串作为命令行参数提供给被调试程序，就像通过 set args 一样。请参见第 4.3 节[参数]，第 38 页。

cwd 	
	如果提供，这应该是一个字符串。gdb 将其工作目录更改为这个目录，就像通过 cd 命令一样（请参见第 4.5 节[工作目录]，第 39 页）。启动的程序将继承这个作为其工作目录。请注意，在处理程序参数之前会更改目录。如果程序是相对文件名，这将影响结果。

env 	
	如果提供，这应该是一个对象。对象的每个键将用作环境变量的名称；每个值必须是一个字符串，并且将是该变量的值。被调试程序的环境将被设置为完全传递的内容。请参见第 4.4 节[环境]，第 38 页。

program 
	如果提供，这是一个指定要使用的程序的字符串。这对应于 file 命令。请参见第 18.1 节[文件]，第 291 页。

stopAtBeginningOfMainSubprogram
	如果提供，这必须是一个布尔值。当为“True”时，gdb 将在程序的主过程中设置一个临时断点，使用与 start 命令相同的方法。请参见第 4.2 节[启动]，第 34 页。

stopOnEntry
	如果提供，这必须是一个布尔值。当为“True”时，gdb 将在程序的第一条指令处设置一个临时断点，使用与 starti 命令相同的方法。请参见第 4.2 节[启动]，第 34 页。
```

gdb 定义了一些可以传递给附加请求的参数。必须指定 pid 或 target，但如果两者都指定，则将忽略 target。

```
pid 
	gdb 应该附加到的进程 ID。请参见第 4.7 节[附加]，第 41 页。

program 
	如果提供，这是一个指定要使用的程序的字符串。这对应于 file 命令。请参见第 18.1 节[文件]，第 291 页。在某些情况下，gdb 可以自动确定正在运行的程序。然而，对于许多远程目标，情况并非如此，因此应该提供此参数。

target 
	gdb 应该连接的目标。这是一个字符串，并传递给 target remote 命令。请参见第 20.1 节[连接]，第 315 页。
```

对于反汇编请求，DAP 允许客户端以实现定义的格式返回每个指令的字节。gdb 通过发送一个以十六进制编码的字节字符串来实现这一点，例如"55a2b900"。

当使用 repl 上下文进行评估请求时，gdb 将提供的表达式作为 CLI 命令进行评估。

一般来说，评估可能会导致被调试程序继续执行。例如，评估 continue 命令可能会这样做，就像评估涉及被调试函数调用的表达式一样。

repl 评估也可能导致 gdb 似乎停止响应请求，例如如果 CLI 脚本进行了长时间的计算。

像这样的评估可以使用 DAP 取消请求中断。（实际上，取消应该对任何请求都有效，但对于大多数请求来说不太可能有用。）

gdb 在 DAP 模式下提供了一些日志设置。这些可以在命令行上使用 -iex 选项设置（请参见第 2.1.1 节[文件选项]，第 12 页）。

```
set debug dap-log-file [filename]
	启用 DAP 日志记录。日志将写入 filename。如果未提供文件名，则停止日志记录。

set debug dap-log-level level
	设置 DAP 日志级别。默认值为“1”，它记录 DAP 协议、开发人员认为有用的任何调试消息以及意外的异常。级别“2”可用于记录所有异常，包括被认为是预期的异常。例如，解析表达式失败将被视为正常异常，通常不会记录。
```