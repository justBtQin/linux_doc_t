# 32 在 gdb 中报告错误

你的错误报告在使 gdb 可靠方面起着至关重要的作用。

报告一个错误可能会通过为你的问题带来解决方案而对你有所帮助，也可能不会。

但在任何情况下，错误报告的主要功能是通过使 gdb 的下一个版本更好地工作来帮助整个社区。错误报告是你对 gdb 维护的贡献。

为了使错误报告达到其目的，你必须包含使我们能够修复错误的信息。

## 32.1 你发现了一个 bug 吗？

如果你不确定是否发现了一个 bug，这里有一些指导方针：

• 如果调试器在任何输入下都收到致命信号，那就是 gdb 的 bug。可靠的调试器永远不会崩溃。

• 如果 gdb 对有效输入产生错误消息，那就是一个 bug。（注意，如果你正在进行交叉调试，问题也可能出在与目标的连接中的某个地方。）

• 如果 gdb 对无效输入不产生错误消息，那就是一个 bug。然而，你应该注意到，你认为的“无效输入”可能是我们认为的“一个扩展”或“对传统实践的支持”。

• 如果你是调试工具的经验丰富的用户，无论如何，我们都欢迎你对 gdb 的改进建议。

## 32.2 如何报告错误

许多公司和个人为 GNU 产品提供支持。如果您从支持组织获得了

gdb，我们建议您首先联系该组织。

您可以在 GNU Emacs 发行版的文件 etc/SERVICE 中找到许多支持公司和个人的联系信息。

无论如何，我们也建议您将 gdb 的错误报告提交到

https://www.gnu.org/software/gdb/bugs/。

有用地报告错误的基本原则是：报告所有事实。如果您不确定是否要陈述一个事实或省略它，请陈述它！

人们经常省略事实，因为他们认为自己知道问题的原因，并假设某些细节无关紧要。因此，您可能会认为在示例中使用的变量的名称无关紧要。嗯，可能确实无关紧要，但不能确定。也许该错误是一个意外的内存引用，恰好从该名称在内存中存储的位置获取；也许，如果名称不同，该位置的内容将使调试器在存在错误的情况下也能正确执行。

安全起见，给出一个具体、完整的示例。这对您来说是最简单的事情，也是最有帮助的。

请记住，错误报告的目的是使我们能够修复错误。可能以前已经报告过该错误，但除非您的错误报告完整且自成一体，否则您和我们都无法知道。

有时人们给出一些粗略的事实并问：“这是否让您想起了什么？”这些错误报告是无用的，我们敦促每个人拒绝响应它们，除非责备发送者正确报告错误。

为了使我们能够修复错误，您应该包括以下所有内容：

• gdb 的版本。如果您在没有参数的情况下启动 gdb，它会宣布版本；您也可以随时使用 show version 打印它。

没有此信息，我们将不知道在当前版本的 gdb 中查找错误是否有任何意义。

• 您使用的机器类型，以及操作系统名称和版本号。

• gdb 构建时配置的详细信息。如果您使用 --configuration 命令行选项调用 gdb，或者在 gdb 的提示符下输入 show configuration，gdb 将显示这些详细信息。

• 用于编译 gdb 的编译器（及其版本）是什么 - 例如“gcc–2.8.1”。

• 用于编译您正在调试的程序的编译器（及其版本）是什么 -

例如“gcc–2.8.1”，或“HP92453-01 A.10.32.03 HP C 编译器”。对于 gcc，您可以使用 gcc --version 获得此信息；对于其他编译器，请参阅这些编译器的文档。

• 您给编译器的命令参数，以编译您的示例并观察错误。例如，您是否使用了‘-O’？为了确保您不会省略重要内容，请列出所有参数。Makefile 的副本（或 make 的输出）就足够了。

如果我们试图猜测参数，我们可能会猜错，然后我们可能不会遇到错误。

• 一个完整的输入脚本，以及所有必要的源文件，以重现错误。

• 对您观察到的您认为不正确的行为的描述。例如，

“它收到一个致命信号。”

当然，如果错误是 gdb 收到一个致命信号，那么我们肯定会注意到它。

但是，如果错误是不正确的输出，我们可能不会注意到，除非它非常明显错误。

您不妨不给我们犯错误的机会。

即使您遇到的问题是一个致命信号，您也应该明确说明。

假设发生了一些奇怪的事情，例如，您的 gdb 副本不同步，或者您在系统上的 C 库中遇到了一个错误。（这种情况已经发生过！）

您的副本可能会崩溃，而我们的不会。如果您告诉我们预期会崩溃，那么当我们的副本没有崩溃时，我们就会知道该错误没有在我们的系统上发生。如果您没有告诉我们预期会崩溃，那么我们将无法从我们的观察中得出任何结论。

为了收集所有这些信息，您可以使用诸如 script 之类的会话记录程序，许多 Unix 系统上都提供了该程序。只需在 script 内部运行您的 gdb 会话，然后将打字稿文件包含在您的错误报告中。

另一种记录 gdb 会话的方法是在 Emacs 内部运行 gdb，然后将整个缓冲区保存到一个文件中。

• 如果您希望对 gdb 源代码提出更改建议，请发送我们上下文差异。如果您甚至在 gdb 源代码中讨论某些内容，请通过上下文引用它，而不是通过行号。

我们开发源代码中的行号将与您的源代码中的行号不匹配。

您的行号对我们没有任何有用的信息。

以下是一些不必要的内容：

• 错误的包络描述。

经常遇到错误的人会花费大量时间调查对输入文件的哪些更改会使错误消失，哪些更改不会影响它。

这通常很耗时且不是很有用，因为我们找到错误的方法是在调试器下运行一个带有断点的示例，而不是通过从一系列示例中进行纯粹的推理。我们建议您将时间用于其他事情。

当然，如果您可以找到一个更简单的示例来报告，而不是原始示例，那对我们来说是方便的。输出中的错误将更容易被发现，在调试器下运行将花费更少的时间，等等。

然而，简化并不是至关重要的；如果您不想这样做，请无论如何报告错误并发送我们您使用的整个测试用例。

• 错误的补丁。

如果是一个好的补丁，错误的补丁对我们有所帮助。但是不要省略必要的信息，例如测试用例，假设补丁是我们所需的全部。我们可能会看到您的补丁的问题并决定以另一种方式修复问题，或者我们可能根本无法理解它。

有时，对于像 gdb 这样复杂的程序，很难构造一个示例，使程序遵循代码中的特定路径。如果您不发送我们示例，我们将无法构造一个，因此我们将无法验证错误是否已修复。

如果我们无法理解您试图修复的错误，或者为什么您的补丁应该是一个改进，我们将不会安装它。一个测试用例将帮助我们理解。

• 关于错误是什么或它依赖于什么的猜测。

这样的猜测通常是错误的。即使我们在没有首先使用调试器找到事实的情况下也无法正确猜测这些事情。